## 概述  
ajax的核心是XMLHttpRequest对象，简称就是XHR，这是微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现。  

### 创建xhr对象  
IE5最早引入XHR对象，在IE5中，XHR对象是通过MSXML库中的一个ActiveX对象实现的。因此，在IE中可能会遇到三种不同版本的XHR对象，即MSXML2.XMLHttp、MSXML2.XMLHttp.3.0和MSXML2.XMLHttp.6.0。  
要使用MSXML库中的XHR对象，需要编写一个函数：  
```javascript  
// 适用于IE7之前的版本
function createXHR(){
    if(typeof arguments.callee.activeXString!='string'){
        var versions=['MSXML2.XMLHttp.6.0','MSXML2.XMLHttp.3.0','MSXML2.XMLHttp'];
        var i,len;
        for(i=0,len=versions.length;i<len;i++){
            try{
                new ActiveXObject(versions[i]);
                arguments.callee.activeXString=versions[i];
                break;
            }catch(ex){
                // 跳过
            }
        }
    }
    return new ActiveXObject(arguments.callee.activeXString);
}
```  
上面这个函数会尽力根据IE中可用的MSXML库的情况，创建最新版本的XHR对象。  

IE7+、Firefox、Opera、Safari都支持原生的XHR对象，在这些浏览器中创建XHR对象，直接使用XMLHttpRequest的构造函数即可：  
```javascript  
var xhr=new XMLHttpRequest();
```  

如果想支持IE7及更高版本，可以直接用原生的XHR实现。但如果还要支持IE的早期版本，那么则可以在这个createXHR()函数中加入对原生XHR对象的支持：  
```javascript
function createXHR(){
    if(typeof XMLHttpRequest!='undefined'){
        return new XMLHttpRequest();
    }else if(typeof ActiveXObject!='undefined'){
        if(typeof arguments.callee.activeXString!='string'){
            var versions=['MSXML2.XMLHttp.6.0','MSXML2.XMLHttp.3.0','MSXML2.XMLHttp'];
            var i,len;
            for(i=0,len=versions.length;i<len;i++){
                try{
                    new ActiveXObject(versions[i]);
                    arguments.callee.activeXString=versions[i];
                    break;
                }catch(ex){
                    // 跳过
                }
            }
        }
        return new ActiveXObject(arguments.callee.activeXString);
    }else{
        throw new Error('No XHR object available');
    }
}
```  
这个函数中首先检测原生的XHR对象是否存在，如果存在着返回它的新实例。如果原生对象不存在，则检测ActiveX对象。如果这两种都不存在，就抛出一个错误，然后可以使用以下方式在所有浏览器中创建XHR对象的实例了：  
```javascript
var xhr=createXHR();
```  

### 使用xhr  

在使用XHR对象时，要调用的第一个方法是open()，它接受3个参数：要发送的请求的类型（get/post...）、请求的URL和表示是否异步发送请求的布尔值。如：  
```javascript  
xhr.open('get','index.ashx',false);  
```  
